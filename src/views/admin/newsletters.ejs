<%- include('partials/header', { title, session, active: 'newsletters' }) %>

<div class="admin-header">
  <h1><i class="fas fa-envelope"></i> Manage Newsletters</h1>
  <div class="admin-header-actions">
    <a href="/admin/newsletters/new?session=<%= session %>" class="btn btn-primary">
      <i class="fas fa-plus"></i> Create Newsletter
    </a>
  </div>
</div>

<!-- Stats -->
<div class="admin-stats">
  <div class="admin-stat-card">
    <div class="admin-stat-icon blue">
      <i class="fas fa-file-alt"></i>
    </div>
    <div class="admin-stat-content">
      <h3><%= stats.drafts || 0 %></h3>
      <p>Drafts</p>
    </div>
  </div>
  <div class="admin-stat-card">
    <div class="admin-stat-icon green">
      <i class="fas fa-paper-plane"></i>
    </div>
    <div class="admin-stat-content">
      <h3><%= stats.sent || 0 %></h3>
      <p>Sent</p>
    </div>
  </div>
  <div class="admin-stat-card">
    <div class="admin-stat-icon orange">
      <i class="fas fa-users"></i>
    </div>
    <div class="admin-stat-content">
      <h3><%= stats.total_recipients || 0 %></h3>
      <p>Total Recipients</p>
    </div>
  </div>
  <div class="admin-stat-card">
    <div class="admin-stat-icon purple">
      <i class="fas fa-envelope-open"></i>
    </div>
    <div class="admin-stat-content">
      <h3><%= stats.total_opens || 0 %></h3>
      <p>Total Opens</p>
    </div>
  </div>
</div>

<!-- Newsletters Table -->
<div class="admin-card">
  <div class="admin-card-body" style="padding: 0;">
    <table class="admin-table">
      <thead>
        <tr>
          <th>Subject</th>
          <th>Status</th>
          <th>Recipients</th>
          <th>Opens</th>
          <th>Clicks</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (newsletters && newsletters.length > 0) { %>
          <% newsletters.forEach(nl => { %>
          <tr>
            <td><strong><%= nl.subject %></strong></td>
            <td>
              <% if (nl.status === 'sent') { %>
              <span class="badge badge-success">Sent</span>
              <% } else if (nl.status === 'scheduled') { %>
              <span class="badge badge-warning">Scheduled</span>
              <% } else { %>
              <span class="badge badge-info">Draft</span>
              <% } %>
            </td>
            <td><%= nl.recipients_count || 0 %></td>
            <td><%= nl.open_count || 0 %></td>
            <td><%= nl.click_count || 0 %></td>
            <td><%= new Date(nl.created_at).toLocaleDateString() %></td>
            <td class="actions">
              <a href="/admin/newsletters/<%= nl.id %>?session=<%= session %>" class="btn-icon" title="Preview">
                <i class="fas fa-eye"></i>
              </a>
              <button class="btn-icon danger delete-action" 
                      data-url="/admin/newsletters/<%= nl.id %>"
                      data-session="<%= session %>"
                      title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="7" class="text-center text-muted" style="padding: 40px;">
              No newsletters yet. <a href="/admin/newsletters/new?session=<%= session %>">Create your first newsletter</a>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer') %>
